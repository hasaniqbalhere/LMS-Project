<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FAST Learning Management System</title>
    <link rel="shortcut icon" href="assets/images/x-icon.png" type="image/x-icon">

    <link rel="stylesheet" href="assets/css/animate.css">
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/icofont.min.css">
    <link rel="stylesheet" href="assets/css/swiper.min.css">
    <link rel="stylesheet" href="assets/css/lightcase.css">
    <link rel="stylesheet" href="assets/css/style.css">
</head>

<body>
    <header class="header-section header-shadow">
        <div class="header-top">
            <div class="container">
                <div class="header-top-area">
                    <ul class="lab-ul left">
                        <li>
                            <i class="icofont-ui-call"></i> <span>+800-123-4567 6587</span>
                        </li>
                        <li>
                            <i class="icofont-location-pin"></i> Beverley, New York 224 USA
                        </li>
                    </ul>
                    <ul class="lab-ul social-icons d-flex align-items-center">
                        <li>
                            <p>Find us on : </p>
                        </li>
                        <li><a href="#" class="fb"><i class="icofont-facebook-messenger"></i></a></li>
                        <li><a href="#" class="twitter"><i class="icofont-twitter"></i></a></li>
                        <li><a href="#" class="vimeo"><i class="icofont-vimeo"></i></a></li>
                        <li><a href="#" class="skype"><i class="icofont-skype"></i></a></li>
                        <li><a href="#" class="rss"><i class="icofont-rss-feed"></i></a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="header-bottom">
            <div class="container">
                <div class="header-wrapper">
                    <div class="logo">
                        <a href="index.html"><img src="assets/images/logo/01.png" alt="logo"></a>
                    </div>
                    <div class="menu-area">
                        <div class="menu" id="menu-container">

                            <script>
                                const user = localStorage.getItem("role");
                                const menucontainer = document.getElementById('menu-container');
                                const html = `
                                
                            <ul class="lab-ul">
                                <li>
                                    <a href="index.html">Home</a>
                                    
                                </li>
                                
                                <li>
                                    ${user === "Admin" ? '<li><a href="admincourse.html">Course Panel</a></li>' : '<li><a href="course.html">Courses</a></li>'}
                                    
                                </li>
                                <li><a href="admin.html">Admin Panel</a> </li>
                                <li>
                                    <a href="team.html">Team</a>
                                    
                                </li>
                                <li><a href="contact.html">Contact</a></li>
                            </ul>
                        
                            `
                                menucontainer.innerHTML += html;
                            </script>
                        </div>

                        <div id="log-btn">
                            <script>
                                const log = document.getElementById('log-btn');
                                const userr = localStorage.getItem("role");
                                const bhtml = `
                                
                                

                                ${!userr ? '<a href="login.html" class="login"><i class="icofont-user"></i> <span>LOG IN</span> </a>' : ''}
                                ${!userr ? '<a href="signup.html" class="signup"><i class="icofont-users"></i><span>SIGN UP</span> </a>' : ''}
                                ${userr === "Admin" || userr === "student" || userr === "teacher" ? '<button class="logout icofont-user"><span>Logout</span></button>' : ''}
                                `
                                log.innerHTML += bhtml;
                                const btn = document.querySelector('.logout');
                                btn.addEventListener("click", (e) => {
                                    e.preventDefault();
                                    localStorage.clear();
                                    alert("logged out Successfully");
                                    window.location.href = "index.html";
                                })


                            </script>
                        </div>

                        <!-- toggle icons -->
                        <div class="header-bar d-lg-none">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                        <div class="ellepsis-bar d-lg-none">
                            <i class="icofont-info-square"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <!-- header section ending here -->
    <div class="pageheader-section">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <div class="pageheader-content text-center">
                        <h2>ALL COURSES</h2>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="courses">
        <div id="courses">
            <table class="table">
                <thead>
                    <tr>
                        <th scope="col">Course ID</th>
                        <th scope="col">Course Name</th>
                        <th scope="col">Course level</th>
                        <th scope="col">Teacher</th>
                        <th scope="col">Category</th>
                    </tr>
                </thead>
                <tbody id="coursesBody"></tbody>
            </table>
            <!-- <script>

                const coursesBody = document.getElementById('coursesBody'); // Get the tbody element

                fetch(`http://localhost:5500/course`)
                    .then(res => res.json())
                    .then(response => {
                        const fetchAndRender = response.map(course => {
                           
                            return fetch(`http://localhost:5500/teacher/getteacher/${course.TeacherID}`)
                                .then(teacherResponse => teacherResponse.json())
                                .then(teacherData => {
                                    fetch(`http://localhost:5500/course/getcategory/${course.Category_ID}`)
                                        .then(categoryResponse => categoryResponse.json())
                                        .then(categoryData => {
                                            console.log(teacherData[0]);
                                            
                                            const tablehtml = `
                                             <tr>
                                            <th scope="row">${course.CourseID}</th>
                                            <td>${course.Course_title}</td>
                                            <td>${course.Course_level}</td>
                                            ${teacherData == null ? ` <td>teacher</td>` : `<td>${teacherData[0].TEACHERNAME}</td>`}
                                            
                                            <td>${categoryData[0].CATEGORY_NAME}</td>
                                </tr>
                            `;
                                            coursesBody.innerHTML += tablehtml;
                                        });
                                });
                        });
                    })
                    .catch(error => {
                        console.error('Error fetching course data:', error);
                    });
            </script> -->
            <script>
                const coursesBody = document.getElementById('coursesBody'); // Get the tbody element
            
                fetch('http://localhost:5500/course')
                    .then(res => res.json())
                    .then(response => {
                        const fetchAndRender = response.map(course => {
                            return Promise.all([
                                fetch(`http://localhost:5500/teacher/getteacher/${course.TeacherID}`)
                                    .then(teacherResponse => teacherResponse.json())
                                    .catch(error => {
                                        console.error('Error fetching teacher data:', error);
                                        return {}; // Return an empty object in case of an error
                                    }),
                                fetch(`http://localhost:5500/course/getcategory/${course.Category_ID}`)
                                    .then(categoryResponse => categoryResponse.json())
                                    .catch(error => {
                                        console.error('Error fetching category data:', error);
                                        return {}; // Return an empty object in case of an error
                                    })
                            ]).then(([teacherData, categoryData]) => {
                                const tablehtml = `
                                    <tr>
                                        <th scope="row">${course.CourseID}</th>
                                        <td>${course.Course_title}</td>
                                        <td>${course.Course_level}</td>
                                        <td>${teacherData && teacherData[0] ? teacherData[0].TEACHERNAME : 'Unknown Teacher'}</td>
                                        <td>${categoryData && categoryData[0] ? categoryData[0].CATEGORY_NAME : 'Unknown Category'}</td>
                                    </tr>
                                `;
                                coursesBody.innerHTML += tablehtml;
                            });
                        });
            
                        // Use Promise.all to wait for all promises to resolve
                        return Promise.all(fetchAndRender);
                    })
                    .catch(error => {
                        console.error('Error fetching course data:', error);
                    });
            </script>
            
        </div>
    </div>

    <div class="pageheader-section">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <div class="pageheader-content text-center">
                        <h2>ALL ENROLLMENTS</h2>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="courses">
        <div id="courses">
            <table class="table">
                <thead>
                    <tr>
                        <th scope="col">Course ID</th>
                        <th scope="col">Course Name</th>
                        <th scope="col">Teacher</th>
                        <th scope="col">Students Enrolled</th>
                    </tr>
                </thead>
                <tbody id="enrollmentsBody"></tbody>
            </table>
            <script>

                const enrollmentsBody = document.getElementById('enrollmentsBody'); // Get the tbody element

                fetch(`http://localhost:5500/course/admincourse`)
                    .then(res => res.json())
                    .then(response => {
                        const fetchAndRender = response.map(course => {
                            console.log(course);
                            const tablehtml = `
                                <tr>
                                    <th scope="row">${course.COURSEID}</th>
                                    <td>${course.COURSE_TITLE}</td>
                                    <td>${course.TEACHERNAME}</td>
                            
                                    <td>${course.STUDENT_COUNT}</td>
                                    
                                </tr>
                            `;
                            enrollmentsBody.innerHTML += tablehtml;
                        });
                    })
                    .catch(error => {
                        console.error('Error fetching course data:', error);
                    });
            </script>
        </div>
    </div>
    <div class="footer-bottom style-2">
        <div class="container">
            <div class="section-wrapper">
                <p>&copy; 2023 <a href="index.html">FAST LMS</a> Designed by <a
                        href="https://www.behance.net/sufyanabdulr" target="_blank">Muhammad Sufyan</a> </p>
            </div>
        </div>
    </div>

</body>

</html>